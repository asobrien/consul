From 99bc0b0fb030f52adc864a7ea9aae0e6b7d0de79 Mon Sep 17 00:00:00 2001
From: arunkumar-m <arunkumar.0190@gmail.com>
Date: Sat, 3 Dec 2016 03:35:09 -0800
Subject: [PATCH] KV command does not pass CONSUL_HTTP_TOKEN (#2566)

---
 command/kv_delete.go | 4 +++-
 command/kv_get.go    | 4 +++-
 command/kv_put.go    | 4 +++-
 3 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/command/kv_delete.go b/command/kv_delete.go
index 85b30b4..efd1ae3 100644
--- a/command/kv_delete.go
+++ b/command/kv_delete.go
@@ -111,7 +111,9 @@ func (c *KVDeleteCommand) Run(args []string) int {
 	// Create and test the HTTP client
 	conf := api.DefaultConfig()
 	conf.Address = *httpAddr
-	conf.Token = *token
+	if (conf.Token == "") {
+		conf.Token = *token
+	}
 	client, err := api.NewClient(conf)
 	if err != nil {
 		c.Ui.Error(fmt.Sprintf("Error connecting to Consul agent: %s", err))
diff --git a/command/kv_get.go b/command/kv_get.go
index 1a54b37..5a21321 100644
--- a/command/kv_get.go
+++ b/command/kv_get.go
@@ -122,7 +122,9 @@ func (c *KVGetCommand) Run(args []string) int {
 	// Create and test the HTTP client
 	conf := api.DefaultConfig()
 	conf.Address = *httpAddr
-	conf.Token = *token
+	if (conf.Token == "") {
+		conf.Token = *token
+	}
 	client, err := api.NewClient(conf)
 	if err != nil {
 		c.Ui.Error(fmt.Sprintf("Error connecting to Consul agent: %s", err))
diff --git a/command/kv_put.go b/command/kv_put.go
index f5e1fa5..de9e0d8 100644
--- a/command/kv_put.go
+++ b/command/kv_put.go
@@ -126,7 +126,9 @@ func (c *KVPutCommand) Run(args []string) int {
 	// Create and test the HTTP client
 	conf := api.DefaultConfig()
 	conf.Address = *httpAddr
-	conf.Token = *token
+	if (conf.Token == "") {
+		conf.Token = *token
+	}
 	client, err := api.NewClient(conf)
 	if err != nil {
 		c.Ui.Error(fmt.Sprintf("Error connecting to Consul agent: %s", err))
